<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CamZip</title>
<link rel="manifest" href="manifest.json" />
<style>
  body { font-family: sans-serif; text-align: center; margin: 0; background: #f5f5f5; }
  header { background: #1976d2; color: white; padding: 1rem; font-size: 1.5rem; }
  button { background: #1976d2; color: white; border: none; padding: 1rem; margin: 1rem; font-size: 1rem; border-radius: 8px; }
  #preview { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 1rem; }
  #preview img { width: 100px; height: auto; margin: 5px; border-radius: 4px; border: 2px solid #ccc; }
</style>
</head>
<body>
<header>CamZip</header>
<main>
  <button id="start-session">Start Session</button>
  <input type="file" accept="image/*" capture="environment" id="camera" style="display:none">
  <button id="take-photo" style="display:none">Take Photo</button>
  <button id="download-zip" style="display:none">Download ZIP</button>
  <div id="preview"></div>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
let folderName = "";
let photos = [];
const startBtn = document.getElementById("start-session");
const takeBtn = document.getElementById("take-photo");
const cameraInput = document.getElementById("camera");
const downloadBtn = document.getElementById("download-zip");
const preview = document.getElementById("preview");

startBtn.onclick = () => {
  folderName = prompt("Enter folder name for this session:");
  if (folderName) {
    photos = [];
    preview.innerHTML = "";
    takeBtn.style.display = "inline-block";
    downloadBtn.style.display = "none";
  }
};

takeBtn.onclick = () => {
  cameraInput.click();
};

cameraInput.onchange = (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      photos.push({ name: `photo_${photos.length + 1}.jpg`, data: ev.target.result });
      const img = document.createElement("img");
      img.src = ev.target.result;
      preview.appendChild(img);
      downloadBtn.style.display = "inline-block";
    };
    reader.readAsDataURL(file);
  }
};

downloadBtn.onclick = () => {
  const zip = new JSZip();
  const imgFolder = zip.folder(folderName);
  photos.forEach(photo => {
    const base64Data = photo.data.split(",")[1];
    imgFolder.file(photo.name, base64Data, { base64: true });
  });
  zip.generateAsync({ type: "blob" }).then(content => {
    const link = document.createElement("a");
    link.href = URL.createObjectURL(content);
    link.download = folderName + ".zip";
    link.click();
  });
};
</script>
</body>
</html>
